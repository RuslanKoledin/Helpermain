# Инструкция по локальному тестированию без AD

## Режим разработки (DEV_MODE)

Для локального тестирования системы без настроенного Active Directory используется режим разработки с тестовыми пользователями.

## Настройка

В файле `.env` установите:
```bash
DEV_MODE=true
```

## Тестовые пользователи

### 1. Обычный пользователь
- **Логин:** `test`
- **Пароль:** `test123`
- **ФИО:** Тестовый Пользователь
- **Отдел:** Отдел тестирования
- **Роль:** Редактор

### 2. Администратор
- **Логин:** `admin`
- **Пароль:** `admin123`
- **ФИО:** Администратор Системы
- **Отдел:** IT отдел
- **Роль:** Супер-администратор

### 3. Гулсая (пример реального пользователя)
- **Логин:** `gulsaya`
- **Пароль:** `test123`
- **ФИО:** Гулсая Асанова
- **Отдел:** Отдел входящей линии
- **Роль:** Редактор

## Как тестировать

### 1. Запустить сервер
```bash
python3 helper7.py
```

### 2. Открыть в браузере
```
http://localhost:5003/
```

### 3. Войти с тестовым пользователем
Используйте любой из логинов выше, например:
- Логин: `test`
- Пароль: `test123`

### 4. Тестировать функциональность

#### Сценарий 1: Просмотр тематик (без рабочего места)
1. Войти → Выбрать "Тематики"
2. Найти тематику → Создать заявку
3. Проверить в Telegram что пришла заявка **без рабочего места**

#### Сценарий 2: Работа с мануалами (с рабочим местом)
1. Войти → Выбрать "Мануалы"
2. Система попросит указать рабочее место (например: `38`)
3. Работать с мануалами → Создать заявку
4. Проверить в Telegram что пришла заявка **с рабочим местом**

#### Сценарий 3: Вход в админ-панель
1. Открыть `http://localhost:5003/admin/login`
2. Войти как `admin` / `admin123`
3. Проверить доступ к админ-панели

## Назначение ролей администраторов

### Способ 1: По логинам (РЕКОМЕНДУЕТСЯ)

В файле `.env` укажите логины пользователей:

```bash
# Обычные администраторы
AD_ADMINS=r_koledin,a_ivanov,i_petrov

# Супер-администраторы
AD_SUPER_ADMINS=r_koledin
```

**Приоритет ролей:**
1. `AD_SUPER_ADMINS` - высшая роль (super_admin)
2. `AD_ADMINS` - обычные админы (admin)
3. `AD_ADMIN_GROUP` - группа в Active Directory (super_admin)
4. По умолчанию - редактор (editor)

### Способ 2: По группе AD

```bash
AD_ADMIN_GROUP=CN=HelperAdmins,OU=Groups,DC=mbank,DC=local
```

Пользователи из этой группы получат роль `super_admin`.

### Тестирование ролей

Запустите скрипт для проверки:
```bash
python3 test_admin_roles.py
```

## Важно!

После получения настроек AD от сисадминов:
1. Установите `DEV_MODE=false` в `.env`
2. Обновите параметры AD:
   - `AD_SERVER`
   - `AD_DOMAIN`
   - `AD_BASE_DN`
   - `AD_ADMIN_GROUP` (опционально)
3. Укажите логины администраторов в `AD_ADMINS` и `AD_SUPER_ADMINS`
4. Перезапустите сервер

## Логи

В режиме разработки в консоли видны логи аутентификации:
```
[DEV MODE] Attempting login for: test
[DEV MODE] Login successful for: test
```

Это помогает отладить процесс входа.
